<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
?>

<?php
$_product    = $this->getProduct();
$_attributes = Mage::helper('core')->decorateArray($this->getAllowAttributes());

$_code = Mage::getModel('eav/entity_attribute_set')->load($_product->getAttributeSetId())->getAttributeSetName();
$attributeInfo = Mage::getResourceModel('eav/entity_attribute_collection')->setCodeFilter($_code)->getFirstItem();
$attributeId = $attributeInfo->getAttributeId();

$attributeOptions = json_decode(Mage::getModel('core/variable')->loadByCode('catalog_attribute_size_options')->getValue('html'), $assoc = true);

?>
    <div class="detailSelectBox">
	<label>
	<select class="super-attribute-select" name="super_attribute[<?php echo $attributeId ?>]" id="attribute<?php echo $attributeId ?>">
<!--	    <option value="0">Select Size:</option>-->
        <option value="0">选择尺码:</option>
		<?php foreach ($attributeOptions[$attributeId]['options'] as $value => $option): ?>
	    <option value="<?php echo $value ?>" price="<?php echo $option['price'] ?>"><?php echo $option['label'] ?></option>
		<?php endforeach ?>
	</select>
	</label>
    </div>
<script type="text/javascript">

    <?php if (!$_product->getJ2tRewardvalue()) : ?>
	var skuXml = '<?php echo $_product->getSku() ?>';
    <?php else : ?>
	var skuXml = '<?php echo substr($_product->getSku(), 6) ?>';
    <?php endif ?>

    jQuery(document).ready(function(jQuery) {
		jQuery.ajax({
			url: '<?php echo Mage::getBaseUrl(Mage_Core_Model_Store::URL_TYPE_WEB); ?>inventory/product/' + skuXml + '.xml',
			type: 'GET',
			dataType: 'xml',
			success: xmlParser,
			error: notFound
		});


		if (!isMobileDevice) {
			jQuery('p.detail-call-order').html('<a>ORDER BY PHONE ONLY. CALL US @ 1-866-339-7463</a>');
		}

    });
    function xmlParser(xml) {
		var sizeOptions = new Array();
		jQuery(xml).find("Info").each(function () {
			var categoryIds = jQuery(this).find('CategoryIds').text();
			categoryIdsArray = new Array();
			categoryIdsArray = categoryIds.split(',');
		});

		jQuery(xml).find('Product').each(function () {
			var optionId = jQuery(this).find('OptionId').text();
			var label = jQuery(this).find('Label').text();

			if (jQuery.inArray('87', categoryIdsArray) >= 0) {
				switch (label) {
					case 'S':
					var additionalLabel = ' (3Y-5Y)';
					break;
					case 'M':
					var additionalLabel = ' (6-8)';
					break;
					case 'L':
					var additionalLabel = ' (8-12)';
					break;
					case 'XL':
					var additionalLabel = ' (12-15)';
					break;
					default:
					var additionalLabel = '';
				}
			} else if (jQuery.inArray('101', categoryIdsArray) >= 0) {
				//Search for nike womens sock
				if(jQuery('.category-header:contains("Women")').text()){
					switch (label) {
						case 'S':
						var additionalLabel = ' (4-6)';
						break;
						case 'M':
						var additionalLabel = ' (6-10)';
						break;
						case 'L':
						var additionalLabel = ' (10-13)';
						break;
						default:
						var additionalLabel = '';
					}
				} else {
					switch (label) {
						case 'S':
						var additionalLabel = ' (3Y-5Y)';
						break;
						case 'M':
						var additionalLabel = ' (6-8)';
						break;
						case 'L':
						var additionalLabel = ' (8-12)';
						break;
						case 'XL':
						var additionalLabel = ' (12-15)';
						break;
						default:
						var additionalLabel = '';
					}
				}
			} else if (jQuery.inArray('118', categoryIdsArray) >= 0) {
				switch (label) {
					case 'S':
					var additionalLabel = ' (6-8.5)';
					break;
					case 'L':
					var additionalLabel = ' (9-13)';
					break;
					default:
					var additionalLabel = '';
				}
			} else {
				var additionalLabel = '';
			}

			jQuery('#attribute<?php echo $attributeId ?> option').each(function(){
				if (jQuery(this).val() == optionId) {
					var thisHtml = jQuery(this).html() + additionalLabel;
					jQuery(this).html(thisHtml);
				}
			});

			sizeOptions.push({
				'option': optionId,
				'label': label,
			});
		});

		if (sizeOptions.length < 1) {
			notFound();
		}

		jQuery('#attribute<?php echo $attributeId ?> option').each(function(){
			if (jQuery(this).val() != '0') {
				jQuery(this).remove();
			}
		});

		if (sizeOptions.length > 0) {
			for (n = 0; n < sizeOptions.length; n++) {
				jQuery('#attribute<?php echo $attributeId ?>').append("<option value='" + sizeOptions[n].option + "'>" + sizeOptions[n].label + "</option>");
			}
		}
    }
	function notFound(){
		jQuery('#attribute<?php echo $attributeId ?>').remove();
		jQuery('.detailSelectBox').hide();
		jQuery('.detailSelectBtn').hide();
		jQuery('.detail-call-order').hide();
		jQuery('.product-shipgroup-label').html('<span class="sold-out">This item is currently sold out.</span>');
		jQuery('p.detail-sold-out').show();
	}

</script>


<!--<p class="detail-sold-out">CURRENTLY SOLD OUT</p>-->
<p class="detail-sold-out">目前售罄</p>

<div class="detailSelectBtn">
<!--	<button class="addToBag" type="submit" onClick="return validateSelect('#attribute--><?php //echo $attributeId ?><!--')">ADD TO BAG</button>-->
    <button class="addToBag" type="submit" onClick="return validateSelect('#attribute<?php echo $attributeId ?>')">添加购物车</button>
</div>
