<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php $_helper = $this->helper('catalog/output'); ?>
<?php $_product = $this->getProduct(); ?>
<script type="text/javascript">
    var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
</script>
<?php
$product_catena = $this->getAttrNameByOptionId("product_catena", $_product->getProductCatena());//篮球系列
$product_material = $this->getAttrNameByOptionId("product_material", $_product->getProductMaterial());//篮球材质;
$product_sku = $_product->getSku();//sku
$product_norm = $this->getAttrNameByOptionId("product_norm", $_product->getProductNorm());//篮球规格
$product_side = $this->getAttrNameByOptionId("product_side", $_product->getProductSide());//篮球场地
$size_table_id = $_product->getSizeTable();//尺码表valueid
$product_attributeSetName = $_product->getAttributeSetName();
//get description
$shortDescription = $_product->getShortDescription();
if (strstr($shortDescription, "直径") && stristr($shortDescription, "mm")) {
    if (strstr($shortDescription, '，')) {
        $tmpArr = explode("，", $shortDescription);
        $shortDescription = "(" . $tmpArr[1] . ")";
    } elseif (strstr($shortDescription, ',')) {
        $tmpArr = explode(",", $shortDescription);
        $shortDescription = "(" . $tmpArr[1] . ")";
    } else {
        $shortDescription = '';
    }
} else {
    $shortDescription = '';
}

//get current category id
$layer = Mage::getSingleton('catalog/layer');
$_category = $layer->getCurrentCategory();
$categoryUrlkey = $_category->getUrlKey();
//定制球衣确认预留   $categoryUrlkey == 'custom-clothes' 这个判断需要删除 并且在后天将产品 is_custom 设置成1
if ($_product->getIsCustom() == 1):
//专属定制
    ?>
    <link rel="stylesheet" type="text/css"
          href="<?php echo $this->getSkinUrl('css/' . $_product->getSku() . '/zns_style_ball.css'); ?>">
    <?php
    echo $this->getChildHtml('custommade_view');
elseif (Mage::getModel('customclothes/customClothes')->checkCustomClothesByProdcut($_product) && Mage::getModel('customclothes/customClothes')->getCustomClothesType($_product) == 'clothes'):
    echo $this->getChildHtml('customclothes_view');
else:
    ?>
    <div class="product-view" style="display: flex;">
       <?php
          $urlkey = $_product->getUrlKey();
          $sku = $_product->getSku();
          $configurableProduct = Mage::getModel('catalog/product')->loadByAttribute('sku', $sku);
          $productNorm = $configurableProduct->getProductNorm();
          if($productNorm == 6){
              // melone 修改url加上2019-
              $scen7 ='/is/image/sneakerhead/2019-spalding_lqxq_small_';
          }else {
              // melone 修改url加上2019-
              $scen7 = '/is/image/sneakerhead/2019-spalding_lqxq_big_';
          }
          $attributeSetModel = Mage::getModel("eav/entity_attribute_set");
          $attributeSetModel->load($_product->getAttributeSetId());
          $attributeSetName = $attributeSetModel->getAttributeSetName();
          $imgCount = $_product->getImageCount();
        ?>


         <!--产品详情 s 左边 -->
      <div class="product-collateral">
              <!--<div class="product-collateral-wrap">-->
                  <!--<div class="product-collateral-box">-->
                    <?php if($_product->getDetailImages()){?>
                        <?php $str = $_product->getDetailImages();
                        $str=explode("\n", $str);
                        $num = count($str);
                        for($i=0;$i<$num;$i++){
//                                        print_r($i);
                            $src =trim($str[$i]);
                            if ($src) {
                                echo  '<div class="product-collateral-box-img"><img src='.$src.' alt=""></div>';
                            }
                        }
                        ?>
                    <?php }else{ ?>
                        <?php if($attributeSetName == 'ball'||$attributeSetName == 'football'): ?>
                            <!--产品信息-->
                            <?php if($attributeSetName == 'ball'){?>
                                 <div class="product-collateral-box-img">
                                <img
                                    src="<?php echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html').$scen7.'info?$spalding_1242_1000$&$location=' . urlencode($this->getAttributeNameById("product_side", $_product->getProductSide()))
                                        . '&$series=' . urlencode($this->getAttributeNameById("product_catena", $_product->getProductCatena())) . '&$number=%20' . strtoupper($_product->getSku()) . '&$size=' . $this->getProductNormImageNameById($_product->getProductNorm()) . '&$texture=' . $this->getProductMaterialImageNameById($_product->getProductMaterial())
                                        . '&$intro=' . urlencode($_product->getDescription()) . '&$title=' . urlencode($_product->getAbstract()) . '&$inorout=' . urlencode($this->getAttributeNameById("product_side", $_product->getProductSide()) . '篮球')
                                        . '&$images=sneakerhead/'.$urlkey . '-1'?>"
                                    alt=""/>
                            </div>
                            <?php }else{?>
                                <div class="product-collateral-box-img">
                                <!-- 足球 spalding_zqxq_info -> 2019-spalding_zqxq_info -->
                                    <img
                                        src="<?php echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html').'/is/image/sneakerhead/2019-spalding_zqxq_info?$spalding_1242_1000$&$location=' . urlencode($this->getAttributeNameById("product_side", $_product->getProductSide()))
                                            . '&$series=' . urlencode($this->getAttributeNameById("product_catena", $_product->getProductCatena())) . '&$number=%20' . strtoupper($_product->getSku()) . '&$size=' . $this->getProductNormImageNameById($_product->getProductNorm()) . '&$texture=' . $this->getProductMaterialImageNameById($_product->getProductMaterial())
                                            . '&$intro=' . urlencode($_product->getDescription()) . '&$title=' . urlencode($_product->getAbstract()) . '&$inorout=' . urlencode($this->getAttributeNameById("product_side", $_product->getProductSide()) . '足球')
                                            . '&$images=sneakerhead/'.$urlkey . '-1'?>"
                                        alt=""/>
                                </div>
                            <?php }?>

                            <!--产品展示-->
                            <div class="product-collateral-box-img">
                            <!-- melone 修改图片-->
                            <!--篮球、训练器材、足球的产品展示图片 s-->
                                <!--<img src='<?php echo $this->getSkinUrl("images2019/detailinfo/title2.jpg") ?>' alt="">-->
                            <!--蓝球、训练器材、足球的产品展示图片 e-->
                            </div>
                            <?php for ($i = 1; $i <=$imgCount; $i++):?>
                                    <?php if ($i > 2): ?>
                                    <?php echo "<br />"  ?>
                                    <?php endif ?>
                                        <div class="product-collateral-box-img box-image">
                                            <img
                                                src="<?php echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html').$scen7 ?>display<?php echo $i ?>?$spalding_1242_1136$&$images=sneakerhead%2F<?php echo $urlkey . "-".$i?>"
                                                alt=""/>
                                        </div>
                            <?php endfor; ?>
                            <!--细节展示-->
                            <div class="product-collateral-box-img box-image">
                             <!--melone 修改图片-->
                                  <!--细节图片展示s-->
                                <!--<img src='<?php echo $this->getSkinUrl("images2019/detailinfo/title3.jpg") ?>' alt="">-->
                                 <!--细节图片展示e-->
                            </div>
                            <?php for ($i = 1; $i <=$imgCount; $i++):?>
                                <div class="product-collateral-box-img box-image">
                                <!-- melone url改成2019-spalding_lqxq_detail -->
                                    <img
                                        src="<?php echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html') ?>/is/image/sneakerhead/2019-spalding_lqxq_detail<?php echo $i ?>?$spalding_1242_620$&$images=sneakerhead/<?php echo $urlkey . "-".$i?>"
                                        alt=""/>
                                </div>
                            <?php endfor; ?>
                        <?php else:?>
                              <!--产品信息-->
                              <!--<div class="product-collateral-box-img">-->
                              <!--<img-->
                              <!--src="--><?php //echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html').'/is/image/sneakerhead/spalding_fsxq_info?$spalding_1242x900$&$size=TF系列&$number=74-716A&$texture='. urlencode($this->getAttributeNameById("product_material_others", $_product->getProductMaterial())) . '&$title=高科技LEGRCY&$images=sneakerhead/'. $urlkey . '-1'?><!--"-->
                              <!--alt=""/>-->
                              <!--</div>-->
                              <!--产品展示-->
                              <div class="product-collateral-box-img">
                              <!-- melone 修改图片-->
                              <!--服饰、配件、篮球架产品展示图 s-->
                                  <!--<img src='<?php echo $this->getSkinUrl("images2019/detailinfo/title2.jpg") ?>' alt="">-->
                              <!--服饰、配件、篮球架产品展示图 e-->
                               <!---->
                              </div>
                                 <?php for ($i = 1; $i <=$imgCount; $i++):?>
                                   <?php if($attributeSetName == 'apparel'){?>
                                        <?php if ($i > 2): ?>
                                        <?php echo "<br />"  ?>
                                        <?php endif ?>
                                        <div class="product-collateral-box-img box-image">
                                        <!-- melone 修改模板尺寸 -->
                                        <!-- melone 修改服饰图片url spalding_fsxq_ -> 2019-spalding_fsxq_-->
                                        <!--配件-->
                                        <img
                                            src="<?php echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html')?>/is/image/sneakerhead/2019-spalding_fsxq_display<?php echo $i ?>?$spalding_1242_1136$&$line=sneakerhead/line_fushi&$side=sneakerhead/fushi_icon_1&$color=\u40657 ?\u33394 ?&$images=sneakerhead/<?php echo $urlkey . "-".$i?>"
                                            alt=""/>
                                        </div>
                                   <?php } else { ?>
                                      <div class="product-collateral-box-img box-image">
                                                <img
                                                    src="<?php echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html').$scen7 ?>display<?php echo $i ?>?$spalding_1242_1136$&$images=sneakerhead%2F<?php echo $urlkey . "-".$i?>"
                                                    alt=""/>
                                            </div>
                                    <?php } ?>
                                <?php endfor; ?>
                                <!--细节展示-->
                                <div class="product-collateral-box-img">
                                <!-- melone 修改图片   衣服的细节展示图片-->
                                    <!--<img src='<?php echo $this->getSkinUrl("images2019/detailinfo/title3.jpg") ?>' alt="">-->
                                </div>
                                <div class="product-collateral-box-img">
                                <img
                                    src="<?php echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html')?>/is/image/sneakerhead/spalding_fsxq_detail?$spalding_1242_620$&$images=sneakerhead/<?php echo $urlkey . "-3"?>"
                                    alt=""/>
                                </div>
                    <?php endif; ?>
                    <?php }?>
       </div>



<!-- 产品详情 e -->

<!-- 右边 -->
        <div class="product-essential">
            <form action="<?php echo $this->getSubmitUrl($_product) ?>" method="post" id="product_addtocart_form"<?php if ($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>
                <?php echo $this->getBlockHtml('formkey') ?>
                <!--<div class="no-display">-->
                    <!--<input type="hidden" name="product" value="<?php echo $_product->getId() ?>"/>-->
                    <!--<input type="hidden" name="related_product" id="related-products-field" value=""/>-->
                <!--</div>-->

                <div class="product-shop">
                    <div class="product-name">
                        <h1><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') . $shortDescription ?></h1>
                    </div>
                <?php echo $this->getChildHtml('alert_urls') ?>
                <!--            --><?php //echo $this->getChildHtml('product_type_data')
                ?>
                <?php echo $this->getTierPriceHtml() ?>
                <?php echo $this->getChildHtml('extrahint') ?>

                <?php if (!$this->hasOptions()): ?>
                    <div class="add-to-box">
                <?php if ($_product->isSaleable()): ?>
                <?php echo $this->getChildHtml('addtocart') ?>
                <?php if ($this->helper('wishlist')->isAllow() || $_compareUrl = $this->helper('catalog/product_compare')->getAddUrl($_product)): ?>
                    <span class="or"><?php echo $this->__('OR') ?></span>
                <?php endif; ?>
                <?php endif; ?>
                <?php echo $this->getChildHtml('addto') ?>
                </div>
                <?php echo $this->getChildHtml('extra_buttons') ?>
                <?php elseif (!$_product->isSaleable()): ?>
                    <div class="add-to-box">
                <?php echo $this->getChildHtml('addto') ?>
                </div>
                <?php endif; ?>

                <?php echo $this->getChildHtml('other'); ?>

                <?php if ($_product->isSaleable() && $this->hasOptions()): ?>
                <?php echo $this->getChildChildHtml('container1', '', true, true) ?>
                <?php endif; ?>
                <?php if ($_product->isSaleable() && $this->hasOptions()): ?>
                <?php echo $this->getChildChildHtml('container2', '', true, true) ?>
                <?php endif; ?>
                <div class="short-description">
                <!-- melone start 修改图片 images->images2019 -->
                    <img alt="" src="<?php echo $this->getSkinUrl("images2019/productDetail_des.png") ?>">
                <!-- melone start 修改图片 images->images2019 -->
                </div>
                </div>

                <div class="product-img-box">
                <?php echo $this->getChildHtml('media') ?>
                </div>

                <div class="clear"></div>

            </form>
          <!-- 产品参数 -->
               <div class="productArgs" style="margin: 0px;">
                    <div class="productArgs_tit">产品参数</div>
                    <div class="productArgs_box" id="productArgs_box">
                        <ul class="clearfix">
                            <li>货号：<?php echo $product_sku; ?></li>
                            <li>篮球规格: <?php echo $product_norm; ?></li>
                            <li>系列：<?php echo $product_catena; ?></li>
                            <li>场地：<?php echo $product_side; ?></li>
                            <li>材质：<?php echo $product_material; ?></li>
                        </ul>
                    </div>
                </div>

            <?php if($attributeSetName == 'ball'||$attributeSetName == 'football'): ?>
                <?php if($attributeSetName == 'ball'){?>
                      <!--篮球规格表-->
                      <div class="product-collateral-box-img">
                      <!-- melone 修改图片-->
                          <img class="hideShowSpecification" id="hideShowSpecification" src='<?php echo $this->getSkinUrl("images2019/detailinfo/balltitle4.jpg") ?>' alt="" style="margin-top: 20px;margin-bottom: -15px">
                      </div>
                      <div class="product-collateral-box-img">
                      <!-- melone 修改图片-->
                          <img class="hideShows" src="<?php echo $this->getSkinUrl('images2019/detailinfo/ball-size.jpg');?>" border="0"  style="display: none;">
                      </div>
                      <!--篮球保养-->
                      <div class="product-collateral-box-img">
                      <!-- melone 修改图片-->
                          <img class="hideShowmaintenance" src='<?php echo $this->getSkinUrl("images2019/detailinfo/balltitle5.jpg") ?>' alt=""  style="margin-top: 10px;margin-bottom: -15px">
                      </div>
                      <div class="product-collateral-box-img">
                      <!-- melone 修改图片-->
                          <img class="hideShowm"  src="<?php echo $this->getSkinUrl('images2019/detailinfo/ball-maintain.jpg');?>" border="0" style="display: none;">
                      </div>
                      <!--篮球结构知识-->
                            <!-- <div class="product-collateral-box-img">-->
                            <!-- <img src="--><?php //echo $this->getSkinUrl('images/detailinfo/ball-structure.jpg');?><!--" border="0">-->
                            <!--</div>-->
                <?php }else{?>
                    <!--足球规格表-->
                    <div class="product-collateral-box-img">
                        <img src='<?php echo $this->getSkinUrl("images/detailinfo/footerballtitle4.jpg") ?>' alt="">
                    </div>
                    <div class="product-collateral-box-img">
                        <img src='<?php echo $this->getSkinUrl("images/detailinfo/footer-size.jpg") ?>' alt="">
                    </div>
                    <!--足球结构知识-->
                    <div class="product-collateral-box-img">
                        <img src='<?php echo $this->getSkinUrl("images/detailinfo/footerballtitle5.jpg") ?>' alt="">
                    </div>
                    <div class="product-collateral-box-img">
                        <img src='<?php echo $this->getSkinUrl("images/detailinfo/footer-structure.jpg") ?>' alt="">
                    </div>
                <?php }?>
            <?php else:?>
               <!-- --><?php //for ($i = 1; $i <=$imgCount; $i++):?>
               <!-- <div class="product-collateral-box-img">-->
               <!-- <img-->
               <!-- src="--><?php //echo Mage::getModel('core/variable')->loadByCode('static_image_domain')->getValue('html')?><!--/is/image/sneakerhead/spalding_fsxq_detail?$spalding_1242_620$&$images=sneakerhead/--><?php //echo $urlkey . "-".$i?><!--"-->
               <!-- alt=""/>-->
               <!-- </div>-->
               <!-- --><?php //endfor; ?>
                <?php if($attributeSetName == 'apparel'){?>
                    <!--服饰尺码表-->
                    <!-- melone 修改服饰尺码表图片   与下面的尺码一体的 images -> images2019-->
                        <?php
                        if (($size_table_id != null)) {
                            $size_table_url = $this->getSkinUrl("images2019/detailinfo/" . $size_table_id . ".jpg");
                            ?>
                            <div class="product-collateral-box-img">
                            <img src='<?php echo $size_table_url; ?>' alt="">
                                </div>
                        <?php
                        }
                        ?>
                      <!--服饰保养-->
                    <div class="product-collateral-box-img">
                        <img src='<?php echo $this->getSkinUrl("images/detailinfo/fushi-maintain.jpg") ?>' alt="">
                        </div>
                <?php }?>
           <?php endif; ?>


                    <!--售后相关-->
                    <div class="product-collateral-box-img">
                    <!-- melone 修改图片-->
                        <img class="hideShowAsale" src='<?php echo $this->getSkinUrl("images2019/detailinfo/title7.jpg") ?>' alt="" style="margin-top: 10px;margin-bottom: -15px;">
                    </div>
                    <div class="product-collateral-box-img">
                    <!-- melone 修改图片-->
                        <img class="hideShowa" src="<?php echo $this->getSkinUrl('images2019/detailinfo/service-1.jpg');?>" border="0" style="display: none;">
                    </div>
                    <div class="product-collateral-box-img">
                    <!-- melone 修改图片-->
                        <img class="hideShowa1" src="<?php echo $this->getSkinUrl('images2019/detailinfo/service-2.jpg');?>" border="0" style="margin-top: 10px">
                    </div>
                <!--</div>-->
                <!--</div>-->


                <script type="text/javascript">
                //<![CDATA[
                var productAddToCartForm = new VarienForm('product_addtocart_form');
                productAddToCartForm.submit = function (button, url) {

                if (this.validator.validate()) {
                var form = this.form;
                var oldUrl = form.action;
                var list = jQuery('input:radio[data-input="kinds"]:checked').val();
                if (list == null) {
                    alert("请选择尺码");
                    return false;
                }

                if (url) {
                    form.action = url;
                }
                var e = null;
                try {
                    this.form.submit();
                } catch (e) {
                }
                this.form.action = oldUrl;
                if (e) {
                    throw e;
                }

                if (button && button != 'undefined') {
                    button.disabled = true;
                }
                }
                }.bind(productAddToCartForm);

                productAddToCartForm.submitLight = function (button, url) {
                if (this.validator) {
                var nv = Validation.methods;
                delete Validation.methods['required-entry'];
                delete Validation.methods['validate-one-required'];
                delete Validation.methods['validate-one-required-by-name'];
                // Remove custom datetime validators
                for (var methodName in Validation.methods) {
                    if (methodName.match(/^validate-datetime-.*/i)) {
                        delete Validation.methods[methodName];
                    }
                }

                if (this.validator.validate()) {
                    if (url) {
                        this.form.action = url;
                    }
                    this.form.submit();
                }
                Object.extend(Validation.methods, nv);
                }
                }.bind(productAddToCartForm);
                //]]>
                </script>
        </div>
   </div>
        <?php echo $this->getChildHtml('upsell_products') ?>
    <?php
endif;
?>
